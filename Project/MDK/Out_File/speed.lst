C251 COMPILER V5.60.0,  speed                                                              05/04/25  19:33:44  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE speed
OBJECT MODULE PLACED IN .\Out_File\speed.obj
COMPILER INVOKED BY: d:\Keil_v5\C251\BIN\C251.EXE ..\USER\src\speed.c XSMALL INTR2 WARNINGLEVEL(3) BROWSE INCDIR(..\..\L
                    -ibraries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\seekfree_peripheral;..\CODE;..\USER\inc;..\USER\sr
                    -c) DEBUG PRINT(.\Out_File\speed.lst) OBJECT(.\Out_File\speed.obj) 

stmt  level    source

    1          #include "speed.h"
    2          #include "math.h"
    3          
    4          int16 aim_speed        = 10;  //Ä¿ï¿½ï¿½ï¿½Ù¶ï¿½  
    5          int16 real_speed       = 0;    //ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Æ½ï¿½ï¿½ï¿½Ù¶ï¿½ 
    6          int16 left_speed       = 0;    //ï¿½ï¿½ï¿½ï¿½ï¿½Ù¶ï¿½
    7          int16 right_speed      = 0;    //ï¿½ï¿½ï¿½ï¿½ï¿½Ù¶ï¿½
    8          int16 last_speed       = 0;    
    9          int16 left_last_speed  = 0;
   10          int16 right_last_speed = 0;
   11          int16 left_real_speed  = 0;
   12          int16 right_real_speed = 0;
   13          
   14          int16 All_PWM_left     = 0;     //ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½PWMï¿½ï¿½ï¿½
   15          int16 All_PWM_right    = 0;     //ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½PWMï¿½ï¿½ï¿½
   16          int16 Speed_pwm_left   = 0;     //ï¿½ï¿½ï¿½ï¿½ï¿½Ù¶È»ï¿½PWMï¿½ï¿½Cï¿½ï¿½ï¿½Ã£ï¿½
   17          int16 Speed_pwm_right  = 0;     //ï¿½ï¿½ï¿½ï¿½ï¿½Ù¶È»ï¿½PWMï¿½ï¿½Cï¿½ï¿½ï¿½Ã£ï¿½
   18          int16 Real_Speed_left  = 0;     //ï¿½ï¿½ï¿½ï¿½Êµï¿½ï¿½ï¿½Ù¶ï¿½
   19          int16 Real_Speed_right = 0;     //ï¿½ï¿½ï¿½ï¿½Êµï¿½ï¿½ï¿½Ù¶ï¿½
   20          int16 Speed_pwm_all    = 0;     //ï¿½ï¿½ï¿½ï¿½Æ½ï¿½ï¿½ï¿½Ù¶È»ï¿½PWMï¿½ï¿½Dï¿½ï¿½ï¿½Ã£ï¿½
   21          int16 Steer_pwm        = 0;     //×ªï¿½ï¿½ï¿½Ú»ï¿½PWM
   22          uint16 Open_pack_time  = 0;     //ï¿½ò¿ª¸É»É¹Ü¶ï¿½Ê±
   23          uint16 Stop_time       = 0;     //Í£ï¿½ï¿½ï¿½ï¿½Ê±
   24           
   25          /******************************* ï¿½ï¿½ï¿½ï¿½ï¿½Ê¼ï¿½ï¿½***********************************
   26          ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½  void init_PWM(unsigned char Motor_Set)
   27          ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½  Motor_Set---Îª0Ê±ï¿½ï¿½Ê¼ï¿½ï¿½ÎªBTNï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê½ï¿½ï¿½Îª1Ê±ï¿½ï¿½Ê¼ï¿½ï¿½DRVï
             -¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê½
   28          Ëµï¿½ï¿½ï¿½ï¿½  ï¿½ï¿½Ä¸10000
   29                              pwm_init(PWMA_CH1P_P60, 10000, 0); 
   30                  ï¿½ï¿½Ê¼ï¿½ï¿½PWM  Ê¹ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½P6.0  ï¿½ï¿½ï¿½PWMÆµï¿½ï¿½10000HZ  Õ¼ï¿½Õ±ï¿½Îªï¿½Ù·ï¿½Ö® 
             -pwm_duty / PWM_DUTY_MAX * 100                          
   31          ï¿½ï¿½ï¿½ï¿½Öµï¿½ï¿½ï¿½ï¿½  
   32          *****************************************************************************/
   33          unsigned char MOTOR_MODE=0;//ï¿½Ð¼ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Þ¸ï¿½É¾ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
   34          void init_PWM(unsigned char Motor_Set)
   35          {
   36   1              MOTOR_MODE = Motor_Set;
   37   1              if (MOTOR_MODE==0) 
   38   1              {
   39   2      //-----MOSï¿½ï¿½ï¿½ï¿½-----------
   40   2          pwm_init(Left_Z_Pin,  20000,0);//ï¿½ï¿½ï¿½Ö³ï¿½Ê¼ï¿½ï¿½
   41   2                pwm_init(Left_F_Pin,  20000,0);
   42   2                pwm_init(Right_Z_Pin, 20000,0);//ï¿½ï¿½ï¿½Ö³ï¿½Ê¼ï¿½ï¿½
   43   2                pwm_init(Right_F_Pin, 20000,0);
   44   2              }
   45   1                      else
   46   1              {
   47   2      //------DRVï¿½ï¿½ï¿½ï¿½-------------
   48   2                pwm_init(Left_PWM_Pin, 20000,0);//ï¿½ï¿½ï¿½Ö³ï¿½Ê¼ï¿½ï¿½
   49   2              pwm_init(Right_PWM_Pin,20000,0);//ï¿½ï¿½ï¿½Ö³ï¿½Ê¼ï¿½ï¿½
   50   2                      gpio_mode(P6_4,GPO_PP);       // ï¿½ï¿½ï¿½ï¿½DRVï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ÎªÎªï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
   51   2                gpio_mode(P6_0,GPO_PP);       // ï¿½ï¿½ï¿½ï¿½DRVï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ÎªÎªï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
   52   2       } 
   53   1      }
   54          /****************************ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê¼ï¿½ï¿½****************************
   55          ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½  void encoder_init(void)
C251 COMPILER V5.60.0,  speed                                                              05/04/25  19:33:44  PAGE 2   

   56          ï¿½ï¿½ï¿½Ü£ï¿½  ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê¼ï¿½ï¿½
   57          ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½  ï¿½ï¿½
   58          Ëµï¿½ï¿½ï¿½ï¿½  ctimer_count_init(CTIM0_P34);
   59                  ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê¹ï¿½ï¿½TIM3ï¿½ï¿½TIM4ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ö»ï¿½ï¿½ï¿½Þ¸Äºê¶¨ï¿½å¼´
             -ï¿½ï¿½ 
   60                  ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê¹ï¿½Ã´ï¿½ï¿½ï¿½ï¿½ï¿½Ä±ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½STCï¿½ï¿½Ö§ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿
             -½ï¿½ë£©
   61          ï¿½ï¿½ï¿½ï¿½Öµï¿½ï¿½ï¿½ï¿½
   62          ********************************************************************/
   63          void encoder_init()
   64          {
   65   1          //ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê¼ï¿½ï¿½
   66   1                      ctimer_count_init(Left_Ecoder_Pin1);
   67   1                      //ï¿½Ò±ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê¼ï¿½ï¿½
   68   1                      ctimer_count_init(Right_Ecoder_Pin1);
   69   1      }  
   70          /***************************ï¿½Ù¶È²ï¿½ï¿½ï¿½********************************
   71          ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½speed_measure()
   72          ï¿½ï¿½  ï¿½Ü£ï¿½ï¿½Ù¶È²ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½È¡ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Öµï¿½ï¿½ï¿½ï¿½Í¬ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï
             -¿½ï¿½×°ï¿½Í³ï¿½ï¿½ï¿½Ç°ï¿½ï¿½ï¿½ï¿½ï¿½ò²»¶Ô»ï¿½
   73                  ï¿½ï¿½ï¿½Â²É¼ï¿½ï¿½ï¿½Öµï¿½ï¿½ï¿½ï¿½ï¿½Ç·ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ä£ï¿½Ö»ï¿½ï¿½ï¿½Þ¸ï¿½* (-1)ï¿½ï¿½ï¿½Ð£
             -ï¿½ï¿½Äµï¿½ï¿½ï¿½ï¿½ï¿½Í¿ï¿½
   74                  ï¿½ï¿½ï¿½ï¿½
   75          ï¿½ï¿½  ï¿½ï¿½ï¿½ï¿½void
   76          ï¿½ï¿½ï¿½ï¿½Öµï¿½ï¿½void
   77          ******************************************************************/
   78          void speed_measure()
   79          { 
   80   1                int16 temp_L, temp_R;
   81   1          temp_L = ctimer_count_read(Left_Ecoder_Pin1); // ï¿½ï¿½ï¿½ï¿½ï¿½Öµï¿½Ç°ï¿½Ù¶ï¿½
   82   1          temp_R = ctimer_count_read(Right_Ecoder_Pin1);
   83   1      
   84   1          ctimer_count_clean(Left_Ecoder_Pin1); // ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
   85   1          ctimer_count_clean(Right_Ecoder_Pin1);
   86   1                
   87   1                if(Left_Ecoder_Pin2 == 1)
   88   1              left_speed = temp_L;
   89   1          else
   90   1              left_speed = (1) * temp_L;
   91   1          if(Right_Ecoder_Pin2 == 0)
   92   1              right_speed = temp_R;
   93   1          else
   94   1              right_speed = (1) * temp_R;
   95   1                      
   96   1                      last_speed = (right_speed+left_speed)/2;// ï¿½Ù¶ï¿½Æ½ï¿½ï¿½Öµ
   97   1                real_speed*=0.8;            //Ò»ï¿½×µï¿½Í¨ï¿½Ë²ï¿½ï¿½ï¿½
   98   1                real_speed+=last_speed*0.2; //Ò»ï¿½×µï¿½Í¨ï¿½Ë²ï¿½ï¿½ï¿½  left_last_speed
   99   1                      
  100   1                      left_last_speed =left_speed;
  101   1                left_real_speed*=0.8;       //Ò»ï¿½×µï¿½Í¨ï¿½Ë²ï¿½ï¿½ï¿½
  102   1                left_real_speed+=left_last_speed*0.2; //Ò»ï¿½×µï¿½Í¨ï¿½Ë²ï¿½ï¿½ï¿½
  103   1                      
  104   1                      right_last_speed =right_speed;
  105   1                right_real_speed*=0.8;        //Ò»ï¿½×µï¿½Í¨ï¿½Ë²ï¿½ï¿½ï¿½
  106   1                right_real_speed+=right_last_speed*0.2; //Ò»ï¿½×µï¿½Í¨ï¿½Ë²ï¿½ï¿½ï¿½
  107   1      }
  108          /*******************************ï¿½ï¿½ï¿½â¶¨Ê±ï¿½ò¿ª¸É»É¹Üµï¿½***********************************
  109          ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½  void timed_task(void)
  110          ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½  ï¿½ï¿½
  111          Ëµï¿½ï¿½ï¿½ï¿½  ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½É¶ï¿½Ê±ï¿½ò¿ª¸É»É¹Üµï¿½ï¿½ï¿½Îªï¿½ï¿½Ö¾Î»ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ö¹ï¿½Õ
             -³ï¿½ï¿½ï¿½Í¼ï¿½âµ½Í£ï¿½ï¿½
  112          ï¿½ï¿½ï¿½ï¿½Öµï¿½ï¿½ï¿½ï¿½ 
  113          *************************************************************************************/
  114          void timed_task(void)
  115          {
  116   1              if(flag_start)
C251 COMPILER V5.60.0,  speed                                                              05/04/25  19:33:44  PAGE 3   

  117   1              {
  118   2                      Open_pack_time=Open_pack_time+10;
  119   2              }
  120   1              if(flag_end)
  121   1              {
  122   2                      T_inku_wait=T_inku_wait+5;
  123   2              }
  124   1              if(T_inku_J)
  125   1              {
  126   2                      T_inku_S=T_inku_S+5;
  127   2              }
  128   1      }
  129          
  130          /*****************************ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½*******************************************
  131          ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½void go_motor (int16 left_PWM,int16 right_PWM)
  132          ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½  int16 left_PWM,int16 right_PWM
  133          Ëµï¿½ï¿½ï¿½ï¿½pwm_duty(PWMA_CH1P_P60, duty);
  134                ï¿½ï¿½Ø½ï¿½ï¿½ï¿½ï¿½ÓµÄµï¿½ï¿½ï¿½ß¼ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ò»ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ò»ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
             -ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ú¶ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Òµï¿½ï¿½
  135                ï¿½ï¿½ï¿½ï¿½Ä²ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Îªï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½×ªï¿½ï¿½ï¿½ï¿½Öµï¿½ï¿½×ªï¿½ï¿½ï¿
             -½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
  136          ï¿½ï¿½ï¿½ï¿½Öµï¿½ï¿½ï¿½ï¿½ 
  137          ********************************************************************************/
  138          #define Duty_Max  6000   //ï¿½Þ·ï¿½ï¿½ï¿½ï¿½Öµ
  139          
  140          void go_motor (int16 left_PWM,int16 right_PWM)
  141          {
  142   1        if  (MOTOR_MODE==0)
  143   1        {     
  144   2      //---------------------------------MOSï¿½ï¿½ï¿½ï¿½-----------------------------------------     
  145   2          if (left_PWM>0)                   //ï¿½ï¿½ï¿½ï¿½
  146   2          {
  147   3                       left_PWM = left_PWM<=Duty_Max ? left_PWM : Duty_Max;
  148   3           pwm_duty(Left_Z_Pin,left_PWM);
  149   3           pwm_duty(Left_F_Pin,0);                        //ï¿½ï¿½×ª
  150   3          }   
  151   2          else 
  152   2          {
  153   3           left_PWM = left_PWM>=-Duty_Max ? (-left_PWM) : Duty_Max;  
  154   3           pwm_duty(Left_Z_Pin,1);    
  155   3           pwm_duty(Left_F_Pin,left_PWM);       //ï¿½ï¿½×ª
  156   3          } 
  157   2          if (right_PWM>0)                  //ï¿½ï¿½ï¿½ï¿½
  158   2          { 
  159   3           right_PWM = right_PWM<=Duty_Max ? right_PWM : Duty_Max; 
  160   3                 pwm_duty(Right_Z_Pin,right_PWM);     
  161   3                 pwm_duty(Right_F_Pin,0);                         //ï¿½ï¿½×ª
  162   3          } 
  163   2          else 
  164   2          {
  165   3           right_PWM = right_PWM>=-Duty_Max ? (-right_PWM) : Duty_Max;  
  166   3                 pwm_duty(Right_Z_Pin,1);     
  167   3                 pwm_duty(Right_F_Pin,right_PWM); //ï¿½ï¿½×ª
  168   3          }
  169   2        }
  170   1        else
  171   1        {
  172   2      //-------------------------------------------DRVï¿½ï¿½ï¿½ï¿½-------------------------------------
  173   2         if (left_PWM>0)                     //ï¿½ï¿½ï¿½ï¿½
  174   2         {
  175   3                       left_PWM = left_PWM<=Duty_Max ? left_PWM : Duty_Max;
  176   3                       Left_DIR_Pin=0;                         
  177   3           pwm_duty(Left_PWM_Pin,left_PWM);  //ï¿½ï¿½×ª
  178   3         }    
  179   2         else 
  180   2         {
C251 COMPILER V5.60.0,  speed                                                              05/04/25  19:33:44  PAGE 4   

  181   3           left_PWM = left_PWM>=-Duty_Max ? (-left_PWM) : Duty_Max;  
  182   3           Left_DIR_Pin=1;    
  183   3           pwm_duty(Left_PWM_Pin,left_PWM);  //ï¿½ï¿½×ª
  184   3         }
  185   2         if (right_PWM>0)                    //ï¿½ï¿½ï¿½ï¿½
  186   2         {
  187   3           right_PWM = right_PWM<=Duty_Max ? right_PWM : Duty_Max;
  188   3           Right_DIR_Pin=0;                    
  189   3                 pwm_duty(Right_PWM_Pin,right_PWM);//ï¿½ï¿½×ª         
  190   3               } 
  191   2         else 
  192   2         {
  193   3           right_PWM = right_PWM>=-Duty_Max ? (-right_PWM) : Duty_Max;  
  194   3                 Right_DIR_Pin=1;
  195   3                 pwm_duty(Right_PWM_Pin,right_PWM); //ï¿½ï¿½×ª
  196   3         }
  197   2        }
  198   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       774     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =        39     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =       119     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
